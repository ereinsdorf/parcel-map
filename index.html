<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Parcel Support Map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />

<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }
.legend {
  position: absolute;
  bottom: 30px;
  left: 10px;
  background: white;
  padding: 10px;
  border-radius: 5px;
  font-family: sans-serif;
  font-size: 12px;
}
.legend div { margin-bottom: 5px; }
.legend span {
  display: inline-block;
  width: 12px;
  height: 12px;
  margin-right: 6px;
}
</style>
</head>

<body>
<div id="map"></div>

<div class="legend">
  <div><span style="background:#FDB813;"></span> Solar</div>
  <div><span style="background:#1f78b4;"></span> BESS</div>
  <div><span style="background:#6a3d9a;"></span> Both</div>
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiZXZhbnJlaW5zZG9yZiIsImEiOiJjbWt5amlxMDkwN3BiM2ZxOW1vajgya2F2In0.-OiZAHRl8PpyJxyseocygA';

const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v11',
    center: [-111.62, 32.82],  // Eloy area
    zoom: 12
});

map.on('load', () => {

    map.addSource('parcels', {
        type: 'geojson',
        data: 'https://ereinsdorf.github.io/parcel-map/parcels.geojson'
    });

    map.addLayer({
        id: 'parcel-fills',
        type: 'fill',
        source: 'parcels',
        paint: {
            'fill-color': [
                'match',
                ['get', 'Type of Support (Solar, BESS, Both)'],
                'Solar', '#FDB813',
                'BESS', '#1f78b4',
                'Both', '#6a3d9a',
                '#cccccc'
            ],
            'fill-opacity': 0.6
        }
    });

    map.addLayer({
        id: 'parcel-borders',
        type: 'line',
        source: 'parcels',
        paint: {
            'line-color': '#333',
            'line-width': 0.5
        }
    });

    // Popup
    map.on('click', 'parcel-fills', (e) => {
        const props = e.features[0].properties;

        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(`
                <b>Name:</b> ${props.Name}<br>
                <b>Support:</b> ${props['Type of Support (Solar, BESS, Both)']}<br>
                <b>Address:</b> ${props.Address}
            `)
            .addTo(map);
    });

    map.on('mouseenter', 'parcel-fills', () => {
        map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'parcel-fills', () => {
        map.getCanvas().style.cursor = '';
    });

});
</script>

</body>
</html>
